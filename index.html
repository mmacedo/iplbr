<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="">
  <meta name="author" content="Michel Pavan Macedo">

  <title>Índice de Poder Legislativo</title>

  <!--Icons-->
  <link rel="apple-touch-icon" sizes="57x57" href="favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon-180x180.png">
  <link rel="shortcut icon" href="favicons/favicon.ico">
  <link rel="icon" type="image/png" href="favicons/favicon-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="favicons/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="favicons/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="favicons/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="favicons/mstile-144x144.png">
  <meta name="msapplication-config" content="favicons/browserconfig.xml">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">

  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
  <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  <!-- Bootstrap -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/bootstrap-theme.min.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-26194428-1', 'michelpm.com');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
  </script>

  <style>
    .grafico {
      width: 100%;
      height: 600px;
    }
  </style>
</head>
<body>
  <div class="container">

    <h1>Índice de Poder Legislativo</h1>

    <div class="panel-group" role="tablist" aria-multiselectable="true">


      <div class="panel panel-default">
        <div class="panel-heading" role="tab" id="cabecalho_cfg_indice">
          <h4 class="panel-title">
            <a data-toggle="collapse" href="#panel_cfg_indice" aria-expanded="true" aria-controls="panel_cfg_indice">Configurar variáveis</a>
          </h4>
        </div>
        <div id="panel_cfg_indice" class="panel-collapse collapse" role="tabpanel" aria-labelledby="cabecalho_cfg_indice">
          <div class="panel-body">

            <form>
              <div class="form-group">
                <label for="peso_ue">Método de peso da UE</label>
                <div class="btn-group btn-group-justified" data-toggle="buttons">
                  <label class="btn btn-default">
                    <input type="radio" name="peso_ue" id="peso_nominal" autocomplete="off"> Nominal
                  </label>
                  <label class="btn btn-default active" aria-pressed="true">
                    <input type="radio" name="peso_ue" id="peso_populacao" autocomplete="off" checked> População
                  </label>
                  <label class="btn btn-default">
                    <input type="radio" name="peso_ue" id="peso_legislativo" autocomplete="off"> Legislativo
                  </label>
                </div>
              </div>

              <div class="form-group">
                <label for="peso_executivo">Peso do executivo</label>
                <div class="btn-group btn-group-justified" data-toggle="buttons">
                  <label class="btn btn-default">
                    <input type="radio" name="peso_executivo" id="peso_zero" autocomplete="off"> Mínimo (zero)
                  </label>
                  <label class="btn btn-default active" aria-pressed="true">
                    <input type="radio" name="peso_executivo" id="peso_media" autocomplete="off" checked> Média (25%)
                  </label>
                  <label class="btn btn-default">
                    <input type="radio" name="peso_executivo" id="peso_metade" autocomplete="off"> Máximo (50%)
                  </label>
                </div>
              </div>
            </form>

          </div>
        </div>
      </div>


      <div class="panel panel-default">
        <div class="panel-heading" role="tab" id="cabecalho_cfg_partidos">
          <h4 class="panel-title">
            <a class="collapsed" data-toggle="collapse" href="#panel_cfg_partidos" aria-expanded="false" aria-controls="panel_cfg_partidos">Configurar partidos</a>
          </h4>
        </div>
        <div id="panel_cfg_partidos" class="panel-collapse collapse" role="tabpanel" aria-labelledby="cabecalho_cfg_partidos">
          <div class="panel-body">

            <form>
              <div class="form-group">
                <label for="configuracao_predefinida">Pré-definição</label>
                <div class="btn-group btn-group-justified" data-toggle="buttons">
                  <label class="btn btn-default">
                    <input type="radio" name="configuracao_predefinida" id="configuracao_todos" autocomplete="off"> Personalizar
                  </label>
                  <label class="btn btn-default active" aria-pressed="true">
                    <input type="radio" name="configuracao_predefinida" id="configuracao_top10" autocomplete="off" checked> Top 10
                  </label>
                  <label class="btn btn-default">
                    <input type="radio" name="configuracao_predefinida" id="configuracao_top3" autocomplete="off"> Top 3
                  </label>
                  <label class="btn btn-default">
                    <input type="radio" name="configuracao_predefinida" id="configuracao_antigos" autocomplete="off"> Antigos
                  </label>
                </div>
              </div>
            </form>

            <div id="panel_personalizar" class="collapse">
              <div class="container-fluid">
                <div class="row">
                  <div class="col-md-3">
                    <div class="panel panel-default">
                      <div class="panel-heading">Aplicar retroativo</div>
                      <div class="panel-body">
                        <div class="checkbox">
                          <label>
                            <input type="checkbox" id="mudancas_de_nome" checked>
                            Mudanças de nome
                          </label>
                        </div>
                        <div class="checkbox">
                          <label>
                            <input type="checkbox" id="incorporacoes" checked>
                            Incorporações
                          </label>
                        </div>
                        <div class="checkbox">
                          <label>
                            <input type="checkbox" id="fusoes" checked>
                            Fusões
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-9">
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>


      <div class="panel panel-default">
        <div class="panel-heading" role="tab" id="cabecalho_cfg_grafico">
          <h4 class="panel-title">
            <a class="collapsed" data-toggle="collapse" href="#panel_cfg_grafico" aria-expanded="false" aria-controls="panel_cfg_grafico">Configurar gráfico</a>
          </h4>
        </div>
        <div id="panel_cfg_grafico" class="panel-collapse collapse" role="tabpanel" aria-labelledby="cabecalho_cfg_grafico">
          <div class="panel-body">
            <div class="container-fluid">
              <div class="row">
                <div class="col-xs-9">
                  <div class="btn-group btn-group-justified" data-toggle="buttons">
                    <label class="btn btn-default">
                      <input type="radio" name="tipo_de_grafico" id="tipo_curvas" autocomplete="off"> Curvas
                    </label>
                    <label class="btn btn-default">
                      <input type="radio" name="tipo_de_grafico" id="tipo_linhas" autocomplete="off"> Linhas
                    </label>
                    <label class="btn btn-default active" aria-pressed="true">
                      <input type="radio" name="tipo_de_grafico" id="tipo_area" autocomplete="off" checked> Área
                    </label>
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" id="passos">
                      Em passos
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


    </div>

    <div role="tabpanel" id="tabpanel_graficos">

      <!-- Nav tabs -->
      <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active">
          <a href="#tab_nacional" aria-controls="tab_nacional" role="tab" data-toggle="tab">Nacional</a>
        </li>
        <li role="presentation">
          <a href="#tab_federal" aria-controls="tab_federal" role="tab" data-toggle="tab">Federal</a>
        </li>
        <li role="presentation">
          <a href="#tab_estadual" aria-controls="tab_estadual" role="tab" data-toggle="tab">Estadual</a>
        </li>
        <li role="presentation">
          <a href="#tab_municipal" aria-controls="tab_municipal" role="tab" data-toggle="tab">Municipal</a>
        </li>
      </ul>

      <!-- Tab panes -->
      <div class="tab-content">
        <div role="tabpanel" class="tab-pane active" id="tab_nacional">
          <div id="indice_nacional" class="grafico"></div>
        </div>
        <div role="tabpanel" class="tab-pane" id="tab_federal">
          <div id="indice_federal" class="grafico"></div>
          <div id="deputados_federais" class="grafico"></div>
          <div id="senadores" class="grafico"></div>
          <div id="congresso_nacional" class="grafico"></div>
          <div id="presidentes" class="grafico"></div>
        </div>
        <div role="tabpanel" class="tab-pane" id="tab_estadual">
          <div id="indice_estadual" class="grafico"></div>
          <div id="deputados_estaduais" class="grafico"></div>
          <div id="governadores" class="grafico"></div>
        </div>
        <div role="tabpanel" class="tab-pane" id="tab_municipal">
          <div id="indice_municipal" class="grafico"></div>
          <div id="vereadores" class="grafico"></div>
          <div id="prefeitos" class="grafico"></div>
        </div>
      </div>

    </div>

  </div>

  <!-- jQuery -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="js/jquery.min.js"%3E%3C/script%3E'))</script>

  <!-- Bootstrap -->
  <script src="js/bootstrap.min.js"></script>

  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <script src="js/ie10-viewport-bug-workaround.js"></script>

  <!-- Highcharts -->
  <script src="//code.highcharts.com/highcharts.js"></script>
  <script>!window.jQuery.fn.highcharts && document.write(unescape('%3Cscript src="js/highcharts.js"%3E%3C/script%3E'))</script>
  <script src="js/exporting.js"></script>
  <script src="js/grid-light.js"></script>

  <!-- Lo-Dash -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
  <script>!_ && document.write(unescape('%3Cscript src="js/lodash.min.js"%3E%3C/script%3E'))</script>

  <script src="js/indice.js"></script>

  <script type="text/javascript">
    function criaGrafico(id, titulo, subtitulo, series) {

      var passosSelecionado = $('#passos').is(':checked:enabled');

      var curvasSelecionado  = $('#tipo_curvas').is(':checked'),
          linhasSelectionado = $('#tipo_linhas').is(':checked'),
          areaSelecionado    = $('#tipo_area').is(':checked');

      var chartType = curvasSelecionado?'spline':linhasSelectionado?'line':'area';
      var stacking  = areaSelecionado?'normal':null;

      $(id).highcharts({
        chart: { type: chartType },
        title: { text: titulo },
        subtitle: { text: subtitulo },
        credits: { enabled: false },
        yAxis: [
          {
            title: { text: '%' },
            tickInterval: 5,
            minorTickInterval: 1,
            floor: 0,
            ceiling: 100,
            reversedStacks: false
          }, {
            title: { text: '%' },
            linkedTo: 0,
            opposite: true
          }
        ],
        xAxis: {
          type: 'datetime',
          tickInterval: 2 * 24 * 3600 * 1000 * 365,
          minorTickInterval: 1 * 24 * 3600 * 1000 * 365
        },
        tooltip: {
          shared: true,
          valueDecimals: 3
        },
        series: series,
        plotOptions: {
          series: {
            marker: { enabled: false },
            step: passosSelecionado?'left':false
          },
          area: {
            stacking: stacking,
            fillOpacity: 1,
            lineWidth: 1,
            states: { hover: { enabled: false } },
          }
        }
      });
    }

    $(function() {

      $(document).on('change', '#configuracao_todos', function(e) {
        if ($(e.currentTarget).is(':checked')) {
          $('#panel_personalizar').addClass('in');
        } else {
          $('#panel_personalizar').removeClass('in');
        }
      });

      // Atualiza os gráficos quando o usuário muda o tipo
      $(document).on('change', '[name="tipo_de_grafico"], [name="configuracao_predefinida"], [name="peso_ue"], [name="peso_executivo"], #passos, #mudancas_de_nome, #incorporacoes, #fusoes', function() {

        if ($('#tipo_curvas').is(':checked')) {
          $('#passos')
            .prop('disabled', true)
            .closest('.checkbox')
            .addClass('disabled')
        } else {
          $('#passos')
            .prop('disabled', false)
            .closest('.checkbox')
            .removeClass('disabled')
        }

        // Destrói todos os gráficos (update tá com bug quando muda para tipo area)
        _.each(Highcharts.charts, function(chart) {
          if (chart != null) {
            chart.destroy();
          }
        });

        // Recria charts da tab atual
        $('#tabpanel_graficos .active > a[data-toggle="tab"]').trigger('shown.bs.tab');
      });

      // fix dimensions of chart that was in a hidden element
      $(document).on('shown.bs.tab', 'a[data-toggle="tab"]', function (e) {
        var panel_id = $(this).attr('aria-controls');
        $("#" + panel_id + " [data-highcharts-chart]").each(function() {
          $(this).highcharts().redraw();
          $(this).highcharts().reflow();
        });
      });

      $.getJSON("eleitos.json").done(function(json) {

        var configuracao = new Configuracao();
        var indices = new GeradorDeIndices(json, configuracao);
        var metodoPesoUe, pesoExecutivo;

        $(document)
          .on('shown.bs.tab', '#tabpanel_graficos a[data-toggle="tab"]', function() {
            configuracao.passos                    = $('#passos').is(':checked:enabled');
            configuracao.mudancasDeNome            = $('#mudancas_de_nome').is(':checked:enabled');
            configuracao.incorporacoes             = $('#incorporacoes').is(':checked:enabled');
            configuracao.fusoes                    = $('#fusoes').is(':checked:enabled');
            configuracao.ehGraficoArea             = $('#tipo_area').is(':checked');
            configuracao.mostraFundacaoEDissolucao = $('#tipo_curvas').is(':checked') || $('#tipo_linhas').is(':checked');

            if ($('#peso_nominal').is(':checked')) {
              metodoPesoUe = 'nominal';
            } else if ($('#peso_legislativo').is(':checked')) {
              metodoPesoUe = 'legislativo';
            } else if ($('#peso_populacao').is(':checked')) {
              metodoPesoUe = 'populacao';
            }

            if ($('#peso_zero').is(':checked')) {
              pesoExecutivo = 0.00;
            } else if ($('#peso_media').is(':checked')) {
              pesoExecutivo = 0.25;
            } else if ($('#peso_metade').is(':checked')) {
              pesoExecutivo = 0.50;
            }

            if ($('#configuracao_todos').is(':checked')) {
              configuracao.tabelaDeReescrita = null;
            } else if ($('#configuracao_top10').is(':checked')) {
              configuracao.tabelaDeReescrita = Configuracao.tabelaTop10;
            } else if ($('#configuracao_top3').is(':checked')) {
              configuracao.tabelaDeReescrita = Configuracao.tabelaTop3;
            } else if ($('#configuracao_antigos').is(':checked')) {
              configuracao.tabelaDeReescrita = Configuracao.tabelaDePartidosAntigos;
            }
          })
          .on('shown.bs.tab', 'a[data-toggle="tab"][aria-controls="tab_nacional"]', function() {

            if ($("#indice_nacional").highcharts() != null) {
              return;
            }

            criaGrafico("#indice_nacional", 'Índice Nacional', 'Federal / 3 + Estadual / 3 + Municipal / 3', indices.indiceNacional(Configuracao.tabelaDeUfs, metodoPesoUe, pesoExecutivo));
          })
          .on('shown.bs.tab', 'a[data-toggle="tab"][aria-controls="tab_federal"]', function() {

            if ($("#indice_federal").highcharts() != null) {
              return;
            }

            var executivo = parseInt(pesoExecutivo * 100, 10).toString();
            var legislativo = parseInt(100 - pesoExecutivo * 100, 10).toString();

            criaGrafico("#indice_federal", 'Índice Federal', 'congresso = ' + legislativo + '% e presidente = ' + executivo + '%', indices.indiceFederal(Configuracao.tabelaDeUfs, metodoPesoUe, pesoExecutivo));
            criaGrafico("#deputados_federais", 'Câmara dos Deputados', null, indices.camaraDosDeputados(Configuracao.tabelaDeUfs, metodoPesoUe, pesoExecutivo));
            criaGrafico("#senadores", 'Senado Federal', null, indices.senadoFederal(Configuracao.tabelaDeUfs, metodoPesoUe, pesoExecutivo));
            criaGrafico("#congresso_nacional", 'Congresso Nacional', 'Câmara dos Deputados + Senado Federal', indices.legislativoFederal(Configuracao.tabelaDeUfs, metodoPesoUe, pesoExecutivo));
            criaGrafico("#presidentes", 'Presidência da República', null, indices.executivoFederal(Configuracao.tabelaDeUfs, metodoPesoUe, pesoExecutivo));
          })
          .on('shown.bs.tab', 'a[data-toggle="tab"][aria-controls="tab_estadual"]', function() {

            if ($("#indice_estadual").highcharts() != null) {
              return;
            }

            var executivo = parseInt(pesoExecutivo * 100, 10).toString();
            var legislativo = parseInt(100 - pesoExecutivo * 100, 10).toString();

            criaGrafico("#indice_estadual", 'Índice Estadual', 'deputados estaduais = ' + legislativo + '% e governadores = ' + executivo + '%', indices.indiceEstadual(Configuracao.tabelaDeUfs, metodoPesoUe, pesoExecutivo));
            criaGrafico("#deputados_estaduais", 'Assembléias Legislativas Estaduais ou Distritais', null, indices.legislativoEstadual(Configuracao.tabelaDeUfs, metodoPesoUe, pesoExecutivo));
            criaGrafico("#governadores", 'Governos Estaduais', null, indices.executivoEstadual(Configuracao.tabelaDeUfs, metodoPesoUe, pesoExecutivo));
          })
          .on('shown.bs.tab', 'a[data-toggle="tab"][aria-controls="tab_municipal"]', function() {

            if ($("#indice_municipal").highcharts() != null) {
              return;
            }

            var executivo = parseInt(pesoExecutivo * 100, 10).toString();
            var legislativo = parseInt(100 - pesoExecutivo * 100, 10).toString();

            criaGrafico("#indice_municipal", 'Índice Municipal', 'vereadores = ' + legislativo + '% e prefeitos = ' + executivo + '%', indices.indiceMunicipal(Configuracao.tabelaDeUfs, metodoPesoUe, pesoExecutivo));
            criaGrafico("#vereadores", 'Câmaras Municipais', null, indices.legislativoMunicipal(Configuracao.tabelaDeUfs, metodoPesoUe, pesoExecutivo));
            criaGrafico("#prefeitos", 'Prefeituras', null, indices.executivoMunicipal(Configuracao.tabelaDeUfs, metodoPesoUe, pesoExecutivo));
          });

        $('#tabpanel_graficos .active > a[data-toggle="tab"]').trigger('shown.bs.tab');

      });
    });
  </script>
</body></html>
