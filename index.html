<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="">
  <meta name="author" content="Michel Pavan Macedo">

  <title>Índice de Poder Legislativo</title>

  <!--Icons-->
  <link rel="apple-touch-icon" sizes="57x57" href="favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon-180x180.png">
  <link rel="shortcut icon" href="favicons/favicon.ico">
  <link rel="icon" type="image/png" href="favicons/favicon-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="favicons/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="favicons/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="favicons/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="favicons/mstile-144x144.png">
  <meta name="msapplication-config" content="favicons/browserconfig.xml">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">

  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
  <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  <!-- Bootstrap -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/bootstrap-theme.min.css" rel="stylesheet">
  <link href="css/bootstrap-toggle.min.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-26194428-1', 'michelpm.com');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
  </script>

  <style>
    .grafico {
      width: 100%;
      height: 600px;
    }
  </style>
</head>
<body>
  <div class="container">

    <h1>Índice de Poder Legislativo</h1>

    <div class="well well-sm">

      <div class="btn-group btn-group-justified" data-toggle="buttons">
        <label class="btn btn-primary">
          <input type="radio" name="peso_ue" id="peso_nominal" autocomplete="off"> Não usa peso
        </label>
        <label class="btn btn-primary active" aria-pressed="true">
          <input type="radio" name="peso_ue" id="peso_populacao" autocomplete="off" checked> Usa população como peso
        </label>
        <label class="btn btn-primary">
          <input type="radio" name="peso_ue" id="peso_legislativo" autocomplete="off"> Usa tamanho do legislativo como peso
        </label>
      </div>

      <div class="btn-group btn-group-justified" data-toggle="buttons">
        <label class="btn btn-primary">
          <input type="radio" name="peso_executivo" id="peso_zero" autocomplete="off"> Peso mínimo com quórum de 50% (zero)
        </label>
        <label class="btn btn-primary active" aria-pressed="true">
          <input type="radio" name="peso_executivo" id="peso_media" autocomplete="off" checked> Média (25%)
        </label>
        <label class="btn btn-primary">
          <input type="radio" name="peso_executivo" id="peso_metade" autocomplete="off"> Peso máximo com quórum de 25% (50%)
        </label>
      </div>

    </div>

    <div class="well well-sm">

      <div class="container-fluid">

        <div class="row">

          <div class="col-md-3">
            <div class="panel panel-default">
              <div class="panel-heading">Aplicar retroativo</div>
              <div class="panel-body">
                <div class="checkbox">
                  <label>
                    <input type="checkbox" id="mudancas_de_nome" data-toggle="toggle" checked>
                    Mudanças de nome
                  </label>
                </div>
                <div class="checkbox">
                  <label>
                    <input type="checkbox" id="incorporacoes" data-toggle="toggle" checked>
                    Incorporações
                  </label>
                </div>
                <div class="checkbox">
                  <label>
                    <input type="checkbox" id="fusoes" data-toggle="toggle" checked>
                    Fusões
                  </label>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-9">
            <div class="panel panel-default">
              <div class="panel-heading">Configuração de partidos</div>
              <div class="panel-body">
                <div class="btn-group btn-group-justified" data-toggle="buttons">
                  <label class="btn btn-primary active" aria-pressed="true">
                    <input type="radio" name="configuracao_predefinida" id="configuracao_todos" autocomplete="off" checked> Todos
                  </label>
                  <label class="btn btn-primary">
                    <input type="radio" name="configuracao_predefinida" id="configuracao_top10" autocomplete="off"> Top 10
                  </label>
                  <label class="btn btn-primary">
                    <input type="radio" name="configuracao_predefinida" id="configuracao_top3" autocomplete="off"> Top 3
                  </label>
                  <label class="btn btn-primary">
                    <input type="radio" name="configuracao_predefinida" id="configuracao_antigos" autocomplete="off"> Antigos
                  </label>
                </div>
              </div>
            </div>
          </div>

        </div>

      </div>

    </div>

    <div class="well well-sm">

      <div class="container-fluid">

        <div class="row">

          <div class="col-md-9">
            <div class="btn-group btn-group-justified" data-toggle="buttons">
              <label class="btn btn-primary active" aria-pressed="true">
                <input type="radio" name="tipo_de_grafico" id="tipo_spline" autocomplete="off" checked> Spline
              </label>
              <label class="btn btn-primary">
                <input type="radio" name="tipo_de_grafico" id="tipo_line" autocomplete="off"> Linha
              </label>
              <label class="btn btn-primary">
                <input type="radio" name="tipo_de_grafico" id="tipo_area" autocomplete="off"> Área
              </label>
              <label class="btn btn-primary">
                <input type="radio" name="tipo_de_grafico" id="tipo_percent" autocomplete="off"> Área (%)
              </label>
            </div>
          </div>

          <div class="col-md-3">
            <input type="checkbox" id="step" data-toggle="toggle" data-on="Com passos" data-off="Sem passos" disabled>
          </div>

        </div>

      </div>

    </div>

    <div role="tabpanel" id="tabpanel_graficos">

      <!-- Nav tabs -->
      <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active">
          <a href="#tab_nacional" aria-controls="tab_nacional" role="tab" data-toggle="tab">Nacional</a>
        </li>
        <li role="presentation">
          <a href="#tab_federal" aria-controls="tab_federal" role="tab" data-toggle="tab">Federal</a>
        </li>
        <li role="presentation">
          <a href="#tab_estadual" aria-controls="tab_estadual" role="tab" data-toggle="tab">Estadual</a>
        </li>
        <li role="presentation">
          <a href="#tab_municipal" aria-controls="tab_municipal" role="tab" data-toggle="tab">Municipal</a>
        </li>
      </ul>

      <!-- Tab panes -->
      <div class="tab-content">
        <div role="tabpanel" class="tab-pane active" id="tab_nacional">
          <div id="indice_nacional" class="grafico"></div>
        </div>
        <div role="tabpanel" class="tab-pane" id="tab_federal">
          <div id="indice_federal" class="grafico"></div>
          <div id="deputados_federais" class="grafico"></div>
          <div id="senadores" class="grafico"></div>
          <div id="congresso_nacional" class="grafico"></div>
          <div id="presidentes" class="grafico"></div>
        </div>
        <div role="tabpanel" class="tab-pane" id="tab_estadual">
          <div id="indice_estadual" class="grafico"></div>
          <div id="deputados_estaduais" class="grafico"></div>
          <div id="governadores" class="grafico"></div>
        </div>
        <div role="tabpanel" class="tab-pane" id="tab_municipal">
          <div id="indice_municipal" class="grafico"></div>
          <div id="vereadores" class="grafico"></div>
          <div id="prefeitos" class="grafico"></div>
        </div>
      </div>

    </div>

  </div>

  <!-- jQuery -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="js/jquery.min.js"%3E%3C/script%3E'))</script>

  <!-- Bootstrap -->
  <script src="js/bootstrap.min.js"></script>
  <script src="js/bootstrap-toggle.min.js"></script>

  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <script src="js/ie10-viewport-bug-workaround.js"></script>

  <!-- Highcharts -->
  <script src="//code.highcharts.com/highcharts.js"></script>
  <script>!window.jQuery.fn.highcharts && document.write(unescape('%3Cscript src="js/highcharts.js"%3E%3C/script%3E'))</script>
  <script src="js/exporting.js"></script>
  <script src="js/grid-light.js"></script>

  <!-- Lazy.js -->
  <script src="js/lazy.min.js"></script>
  <script src="js/indice.js"></script>

  <script type="text/javascript">
    function criaGrafico(id, titulo, subtitulo, serie) {

      var stepChecked = $('#step').is(':checked:enabled');

      var splineChecked  = $('#tipo_spline').is(':checked'),
          lineChecked    = $('#tipo_line').is(':checked'),
          areaChecked    = $('#tipo_area').is(':checked'),
          percentChecked = $('#tipo_percent').is(':checked');

      var chartType = splineChecked?'spline':lineChecked?'line':'area';
      var stacking  = areaChecked?'normal':percentChecked?'percent':null;

      $(id).highcharts({
        chart: { type: chartType },
        title: { text: titulo },
        subtitle: { text: subtitulo },
        yAxis: {
          title: { text: '%' },
          floor: 0,
          ceiling: 100,
          reversedStacks: false
        },
        xAxis: { type: 'datetime' },
        tooltip: {
          crosshairs: true,
          shared: true,
          valueDecimals: 2
        },
        series: serie,
        plotOptions: {
          series: { marker: { enabled: false }, step: stepChecked?'left':false },
          area: { stacking: stacking, fillOpacity: 1 }
        }
      });
    }

    $(function() {

      // Atualiza os gráficos quando o usuário muda o tipo
      $(document).on('change', '[name="tipo_de_grafico"], [name="configuracao_predefinida"], [name="peso_ue"], [name="peso_executivo"], #step, #mudancas_de_nome, #incorporacoes, #fusoes', function() {

        if ($(this).is('#tipo_spline')) {
          $('#step').bootstrapToggle('disable');
        } else {
          $('#step').bootstrapToggle('enable');
        }

        // Destrói todos os gráficos (update tá com bug quando muda para tipo area)
        Lazy(Highcharts.charts).each(function(chart) {
          if (chart != null) {
            chart.destroy();
          }
        });

        // Recria charts da tab atual
        $('#tabpanel_graficos .active > a[data-toggle="tab"]').trigger('shown.bs.tab');
      });

      // fix dimensions of chart that was in a hidden element
      $(document).on('shown.bs.tab', 'a[data-toggle="tab"]', function (e) {
        var panel_id = $(this).attr('aria-controls');
        $("#" + panel_id + " [data-highcharts-chart]").each(function() {
          $(this).highcharts().redraw();
          $(this).highcharts().reflow();
        });
      });

      $.getJSON("eleitos.json").done(function(json) {

        var configuracao = new Configuracao();
        var indices = new GeradorDeIndices(json, configuracao);
        var pesoUe, pesoExecutivo;

        $(document)
          .on('shown.bs.tab', '#tabpanel_graficos a[data-toggle="tab"]', function() {
            configuracao.passos           = $('#step').is(':checked:enabled');
            configuracao.mudancasDeNome   = $('#mudancas_de_nome').is(':checked:enabled');
            configuracao.incorporacoes    = $('#incorporacoes').is(':checked:enabled');
            configuracao.fusoes           = $('#fusoes').is(':checked:enabled');
            configuracao.completaExtremos = $('#tipo_spline').is(':checked') || $('#tipo_line').is(':checked');

            if ($('#peso_nominal').is(':checked')) {
              pesoUe = 'nominal';
            } else if ($('#peso_legislativo').is(':checked')) {
              pesoUe = 'legislativo';
            } else if ($('#peso_populacao').is(':checked')) {
              pesoUe = 'populacao';
            }

            if ($('#peso_zero').is(':checked')) {
              pesoExecutivo = 0.00;
            } else if ($('#peso_media').is(':checked')) {
              pesoExecutivo = 0.25;
            } else if ($('#peso_metade').is(':checked')) {
              pesoExecutivo = 0.50;
            }

            if ($('#configuracao_todos').is(':checked')) {
              configuracao.tabelaDeReescrita = null;
            } else if ($('#configuracao_top10').is(':checked')) {
              configuracao.tabelaDeReescrita = Configuracao.tabelaTop10;
            } else if ($('#configuracao_top3').is(':checked')) {
              configuracao.tabelaDeReescrita = Configuracao.tabelaTop3;
            } else if ($('#configuracao_antigos').is(':checked')) {
              configuracao.tabelaDeReescrita = Configuracao.tabelaDePartidosAntigos;
            }
          })
          .on('shown.bs.tab', 'a[data-toggle="tab"][aria-controls="tab_nacional"]', function() {

            if ($("#indice_nacional").highcharts() != null) {
              return;
            }

            criaGrafico("#indice_nacional", 'Índice Nacional', 'Federal / 3 + Estadual / 3 + Municipal / 3', indices.indiceNacional(pesoUe, pesoExecutivo));
          })
          .on('shown.bs.tab', 'a[data-toggle="tab"][aria-controls="tab_federal"]', function() {

            if ($("#indice_federal").highcharts() != null) {
              return;
            }

            var executivo = parseInt(pesoExecutivo * 100, 10).toString();
            var legislativo = parseInt(100 - pesoExecutivo * 100, 10).toString();

            criaGrafico("#indice_federal", 'Índice Federal', 'congresso = ' + legislativo + '% e presidente = ' + executivo + '%', indices.indiceFederal(pesoUe, pesoExecutivo));
            criaGrafico("#deputados_federais", 'Câmara dos Deputados', null, indices.deputadosFederais(pesoUe, pesoExecutivo));
            criaGrafico("#senadores", 'Senado Federal', null, indices.senadores(pesoUe, pesoExecutivo));
            criaGrafico("#congresso_nacional", 'Congresso Nacional', 'Câmara dos Deputados + Senado Federal', indices.congressoNacional(pesoUe, pesoExecutivo));
            criaGrafico("#presidentes", 'Presidência da República', null, indices.presidentes(pesoUe, pesoExecutivo));
          })
          .on('shown.bs.tab', 'a[data-toggle="tab"][aria-controls="tab_estadual"]', function() {

            if ($("#indice_estadual").highcharts() != null) {
              return;
            }

            var executivo = parseInt(pesoExecutivo * 100, 10).toString();
            var legislativo = parseInt(100 - pesoExecutivo * 100, 10).toString();

            criaGrafico("#indice_estadual", 'Índice Estadual', 'deputados estaduais = ' + legislativo + '% e governadores = ' + executivo + '%', indices.indiceEstadual(pesoUe, pesoExecutivo));
            criaGrafico("#deputados_estaduais", 'Assembléias Legislativas Estaduais ou Distritais', null, indices.deputadosEstaduais(pesoUe, pesoExecutivo));
            criaGrafico("#governadores", 'Governos Estaduais', null, indices.governadores(pesoUe, pesoExecutivo));
          })
          .on('shown.bs.tab', 'a[data-toggle="tab"][aria-controls="tab_municipal"]', function() {

            if ($("#indice_municipal").highcharts() != null) {
              return;
            }

            var executivo = parseInt(pesoExecutivo * 100, 10).toString();
            var legislativo = parseInt(100 - pesoExecutivo * 100, 10).toString();

            criaGrafico("#indice_municipal", 'Índice Municipal', 'vereadores = ' + legislativo + '% e prefeitos = ' + executivo + '%', indices.indiceMunicipal(pesoUe, pesoExecutivo));
            criaGrafico("#vereadores", 'Câmaras Municipais', null, indices.vereadores(pesoUe, pesoExecutivo));
            criaGrafico("#prefeitos", 'Prefeituras', null, indices.prefeitos(pesoUe, pesoExecutivo));
          });

        $('#tabpanel_graficos .active > a[data-toggle="tab"]').trigger('shown.bs.tab');

      });
    });
  </script>
</body></html>
